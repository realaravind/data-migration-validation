metadata:
  name: test_enhanced_error_messages
  description: Test pipeline to verify enhanced error messages
  project_id: dw_validation
  validation_type: comparative

source:
  type: sqlserver
  database: ${SQL_DATABASE}
  schema: dim
  table: dim_product

target:
  type: snowflake
  database: ${SNOWFLAKE_DATABASE}
  schema: DIM
  table: DIM_PRODUCT

steps:
- name: test_row_order_issue
  type: comparative
  validator: custom_sql
  description: Test row order detection - same data, different order
  enabled: true
  config:
    sql_server_query: SELECT * FROM DIM.dim_product WHERE category = 'Electronics'
    snowflake_query: SELECT * FROM DIM.DIM_PRODUCT WHERE category = 'Electronics'
    compare_mode: result_set
    tolerance: 0.0
    ignore_column_order: true
    ignore_row_order: false  # Intentionally false to trigger row order detection
  metadata:
    test_case: row_order_detection

- name: test_actual_data_difference
  type: comparative
  validator: custom_sql
  description: Test actual data difference detection
  enabled: true
  config:
    sql_server_query: SELECT product_id, product_name, unit_price FROM DIM.dim_product WHERE product_key <= 5 ORDER BY product_key
    snowflake_query: SELECT product_id, product_name, unit_price FROM DIM.DIM_PRODUCT WHERE product_key <= 5 ORDER BY product_key
    compare_mode: result_set
    tolerance: 0.0
    ignore_column_order: true
    ignore_row_order: false
  metadata:
    test_case: data_difference_detection
